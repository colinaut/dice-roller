{"version":3,"file":"dice-roller.js","sources":["../src/main.ts"],"sourcesContent":["export default class DiceRoller extends HTMLElement {\n\tprivate shadow: ShadowRoot;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.shadow = this.attachShadow({ mode: \"open\" });\n\t}\n\n\tprivate getA(attr: string, fallback: string = \"\"): string {\n\t\treturn this.getAttribute(attr) || fallback;\n\t}\n\n\tget dice(): string[] {\n\t\tconst diceAttr = this.getA(\"dice\", \"6\");\n\t\tconst diceArray = diceAttr.split(\",\");\n\t\treturn diceArray;\n\t}\n\n\tget bonusDie(): number {\n\t\tconst bonusDie = this.getA(\"bonus-die\", \"0\");\n\t\treturn Number(bonusDie);\n\t}\n\n\tget modifier(): number {\n\t\tconst modifier = this.getA(\"modifier\", \"0\");\n\t\treturn Number(modifier);\n\t}\n\n\tget total(): string {\n\t\treturn this.getA(\"total\", \"sum\");\n\t}\n\n\tget difficulty(): number {\n\t\treturn Number(this.getA(\"difficulty\", \"0\"));\n\t}\n\n\tget title(): string {\n\t\treturn this.getA(\"title\");\n\t}\n\n\tget size(): number {\n\t\treturn Number(this.getA(\"size\", \"1\"));\n\t}\n\n\tstatic get observedAttributes(): string[] {\n\t\treturn [\"dice\", \"modifier\", \"best-of\"];\n\t}\n\n\tprivate dieRolls: number[] = [];\n\tprivate bonusDieRoll: number = 0;\n\tprivate finalTotal: number | undefined = undefined;\n\tprivate success: boolean = false;\n\n\tpublic connectedCallback(): void {\n\t\tthis.render();\n\t\tthis.addEventListeners();\n\t}\n\n\tprivate rollDie(sides: number) {\n\t\treturn Math.floor(Math.random() * sides + 1);\n\t}\n\n\tprivate rollDice() {\n\t\tthis.dieRolls = [];\n\t\tthis.bonusDieRoll = 0;\n\t\tthis.dice.forEach((die, i) => {\n\t\t\tthis.dieRolls[i] = this.rollDie(Number(die));\n\t\t});\n\t}\n\n\tprivate sumTotal(): number {\n\t\tlet total: number;\n\t\tif (this.total === \"highest\") {\n\t\t\ttotal = this.maxDie();\n\t\t} else if (this.total === \"highest-two\") {\n\t\t\ttotal = this.twoHighest().reduce(function (accum, curValue) {\n\t\t\t\treturn accum + curValue;\n\t\t\t}, 0);\n\t\t} else if (this.total === \"lowest\") {\n\t\t\ttotal = this.minDie();\n\t\t} else if (this.total === \"lowest-two\") {\n\t\t\tconsole.log(\"lowest-two\");\n\n\t\t\ttotal = this.twoLowest().reduce(function (accum, curValue) {\n\t\t\t\treturn accum + curValue;\n\t\t\t}, 0);\n\t\t} else {\n\t\t\ttotal = this.dieRolls.reduce(function (accum, curValue) {\n\t\t\t\treturn accum + curValue;\n\t\t\t}, 0);\n\t\t}\n\t\tif (this.bonusDie > 0) {\n\t\t\tthis.bonusDieRoll = this.rollDie(this.bonusDie);\n\t\t\ttotal += this.bonusDieRoll;\n\t\t}\n\t\tthis.finalTotal = total + this.modifier;\n\t\tif (this.difficulty > 0) {\n\t\t\tthis.success = total >= this.difficulty;\n\t\t}\n\t\treturn this.finalTotal;\n\t}\n\n\tprivate maxDie(): number {\n\t\tconst max: number = this.dieRolls.reduce(function (a: number, b: number) {\n\t\t\treturn Math.max(a, b);\n\t\t}, -Infinity);\n\t\treturn max;\n\t}\n\n\tprivate minDie(): number {\n\t\tconst max: number = this.dieRolls.reduce(function (a: number, b: number) {\n\t\t\treturn Math.min(a, b);\n\t\t}, Infinity);\n\t\treturn max;\n\t}\n\n\tprivate twoHighest(): number[] {\n\t\treturn this.dieRolls.reduce(\n\t\t\t(acc, rec) => {\n\t\t\t\treturn rec > acc[1] ? [acc[1], rec] : rec > acc[0] ? [rec, acc[1]] : acc;\n\t\t\t},\n\t\t\t[0, 0]\n\t\t);\n\t}\n\n\tprivate twoLowest(): number[] {\n\t\treturn this.dieRolls.reduce(\n\t\t\t(acc, rec) => {\n\t\t\t\tconsole.log(acc);\n\n\t\t\t\treturn rec < acc[1] ? [acc[1], rec] : rec < acc[0] ? [rec, acc[1]] : acc;\n\t\t\t},\n\t\t\t[Infinity, Infinity]\n\t\t);\n\t}\n\n\tprivate rollAnimation() {\n\t\tconst changeDieFace = () => {\n\t\t\t// console.log(\"ðŸš€ ~ file: main.ts:49 ~ DiceRoller ~ changeDieFace ~ this.dieRoll\", this.dieRoll);\n\t\t\tthis.rollDice();\n\t\t\tthis.render();\n\t\t};\n\n\t\tlet nIntervalId: number | undefined | ReturnType<typeof setInterval>;\n\n\t\tif (!nIntervalId) {\n\t\t\tnIntervalId = setInterval(changeDieFace, 100);\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tclearInterval(nIntervalId);\n\t\t\tthis.sumTotal();\n\t\t\tthis.render();\n\t\t}, 1000);\n\t}\n\n\tprivate addEventListeners(): void {\n\t\tconst shadow = this.shadow;\n\t\tshadow.addEventListener(\n\t\t\t\"click\",\n\t\t\t() => {\n\t\t\t\tconsole.log(\"roll\");\n\n\t\t\t\tthis.finalTotal = undefined;\n\t\t\t\tthis.success = false;\n\t\t\t\tthis.render();\n\t\t\t\tthis.rollAnimation();\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t}\n\n\tpublic attributeChangedCallback(name: string, oldValue: string, newValue: string) {\n\t\tconsole.log(\"changed\", name, oldValue, newValue);\n\t}\n\n\tprivate render() {\n\t\tconst modifier: string = this.modifier > 0 ? \"+\" + this.modifier.toString() : this.modifier < 0 ? this.modifier.toString() : \"\";\n\t\tconst bonusDieText: string = this.bonusDie > 0 ? `+ bonus ${this.bonusDie}d` : \"\";\n\t\tconst title = this.title || `${this.dice} ${this.total} ${modifier} ${bonusDieText}`;\n\t\tconst size = this.size;\n\t\tconst finalTotal = this.finalTotal !== undefined ? `<div class=\"total\"><h5>TOTAL</h5><span>${this.finalTotal}</span></div>` : \"\";\n\t\tconst success =\n\t\t\tthis.finalTotal !== undefined && this.difficulty > 0\n\t\t\t\t? this.success\n\t\t\t\t\t? \"<div class='result success'><span>Success!</span></div>\"\n\t\t\t\t\t: \"<div class='result failure'><span>Fail</span></div>\"\n\t\t\t\t: \"\";\n\t\tconst css = `\n        <style>\n            :host {\n                margin: 1rem 0;\n                display: block;\n                font-weight: 700;\n                max-width: max-content;\n                --dice-bg: transparent;\n                --dice-border: 2px solid #fff;\n                --modifier-bg: transparent;\n                --modifier-border: 2px solid transparent;\n                --total-bg: transparent;\n                --total-border: 2px solid transparent;\n            }\n            .dice {\n                display: flex;\n                gap: .6em;\n                flex-wrap: wrap;\n                width: fit-content;\n            }\n            .die {\n                width: ${size * 2}em;\n                height: ${size * 2}em;\n                border: var(--dice-border);\n                border-radius: ${size / 2}em;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .die span {\n                font-size: ${size}em;\n            }\n            .modifier {\n                width: 1em;\n                height: 2em;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border: var(--modifier-border);\n                background: var(--modifier-bg);\n                font-size: ${size}em;\n            }\n            .modifier:empty {\n                display: none;\n            }\n            .modifier.plus {\n                width: ${size / 2}em;\n            }\n            .total {\n                width: ${size * 2}em;\n                height: ${size * 2}em;\n                display: flex;\n                line-height: 1;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                border: var(--total-border);\n                background: var(--total-bg);\n                position: relative;\n            }\n            .total h5 {\n                margin: 0;\n                font-size: ${size / 2.5}em;\n                position: absolute;\n                top:0;\n            }\n            .total span {\n                font-size: ${size}em;\n            }\n            .result {\n                height: ${size * 2}em;\n                display: flex;\n                line-height: 1;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .result span {\n                font-size: ${size / 1.5}em;\n            }\n            h4 {\n                display: flex;\n                gap: ${size / 2}em;\n                font-size: ${size / 1.5}em;\n                margin: 0 0 .4em;\n            }\n            \n        </style>\n        `;\n\n\t\tlet bonusDie = \"\";\n\n\t\tif (this.bonusDie > 0) {\n\t\t\tconst bonusDieRoll = this.bonusDieRoll > 0 ? this.bonusDieRoll : `d${this.bonusDie}`;\n\t\t\tbonusDie = `<div class=\"modifier plus\">+</div><div class=\"die bonus\"><span>${bonusDieRoll}</span></div>`;\n\t\t}\n\n\t\tlet html = `\n        <div>\n            <h4>${title}</h4>\n            <div class=\"dice\">\n                ${this.dice\n\t\t\t\t\t.map((dice, i) => {\n\t\t\t\t\t\tconst text = this.dieRolls[i] || `d${dice}`;\n\t\t\t\t\t\treturn `<div class=\"die\"><span>${text}</span></div>`;\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\")}\n                <div class=\"modifier\">${modifier}</div>\n                ${bonusDie}\n                ${finalTotal}\n                ${success}\n            </div>\n        </div>\n        `;\n\n\t\tthis.shadow.innerHTML = `${css}${html}`;\n\t}\n}\ncustomElements.define(\"dice-roller\", DiceRoller);\n"],"names":["DiceRoller","__publicField","attr","fallback","bonusDie","modifier","sides","die","i","total","accum","curValue","a","b","acc","rec","changeDieFace","nIntervalId","name","oldValue","newValue","bonusDieText","title","size","finalTotal","success","css","html","dice"],"mappings":"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"}